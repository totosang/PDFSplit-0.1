<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>PDFSplit - Secure</title>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>:root{--bh:250px}body{font-family:Sarabun,sans-serif;background:#f4f4f9;display:flex;flex-direction:column;align-items:center;padding:20px}#d-z{width:80%;max-width:600px;height:120px;border:2px dashed #007bff;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#fff;color:#007bff;cursor:pointer;margin-bottom:20px}.toolbar{display:flex;gap:15px;align-items:center;margin-bottom:20px;background:#fff;padding:10px 20px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.1)}#p-l{width:98%;max-width:1600px;display:flex;flex-wrap:wrap;gap:20px;justify-content:center;align-items:flex-start}.page-card{background:#fff;border:1px solid #ddd;border-radius:8px;padding:10px;width:fit-content;display:flex;flex-direction:column;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,.1);position:relative;cursor:grab;transition:.2s}.page-card.selected{border:3px solid #28a745;background:#f0fff4}.page-card.dragging{opacity:.4;border:2px dashed #007bff}canvas{height:var(--bh);width:auto;border:1px solid #eee;pointer-events:none;display:block}.page-number-label{position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:2px 10px;border-radius:10px;font-size:.8rem;z-index:25}.rotate-btn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:45px;height:45px;background:rgba(0,0,0,.6);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;opacity:0;transition:.2s}.page-card:hover .rotate-btn{opacity:1}.delete-btn{position:absolute;top:-10px;right:-10px;width:28px;height:28px;background:#ff4d4d;color:#fff;border:2px solid #fff;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:30}.action-buttons{display:none;position:sticky;bottom:20px;z-index:100;gap:15px;background:rgba(255,255,255,.9);padding:15px;border-radius:15px;box-shadow:0 5px 20px rgba(0,0,0,.15);backdrop-filter:blur(5px)}.btn-action{padding:12px 25px;color:#fff;border-radius:50px;border:none;cursor:pointer;font-weight:700}.btn-merge{background:#28a745}.btn-zip{background:#007bff}.btn-jpg{background:#ffc107;color:#333}</style>
</head>
<body>
<h1>PDFSplit - Secure</h1>
<div class="toolbar">
    <label>Zoom:</label><input type="range" id="z-s" min="150" max="500" value="250">
    <button onclick="_sa(1)">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏î</button><button onclick="_sa(0)">‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
    <button id="reset-btn" onclick="_rs()">Reset</button>
</div>
<div id="d-z">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
<input type="file" id="f-i" multiple accept="application/pdf" style="display:none">
<div id="p-l"></div>
<div class="action-buttons" id="a-a">
    <button class="btn-action btn-merge" onclick="_pr('merge')">üìë ‡∏£‡∏ß‡∏°‡πÑ‡∏ü‡∏•‡πå</button>
    <button class="btn-action btn-zip" onclick="_pr('zip')">üì¶ ‡πÅ‡∏¢‡∏Å ZIP</button>
    <button class="btn-action btn-jpg" onclick="_pr('jpg')">üñºÔ∏è ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
</div>
<script>
(function(){pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';const _q=s=>document.getElementById(s),_dz=_q('d-z'),_fi=_q('f-i'),_pl=_q('p-l'),_aa=_q('a-a'),_zs=_q('z-s');let _pm=new Map(),_sm=new Map(),_bh=250;_zs.oninput=e=>{_bh=parseInt(e.target.value);document.documentElement.style.setProperty('--bh',_bh+'px')};_zs.onchange=()=>_rv();async function _rv(){for(const c of _0x.querySelectorAll('.page-card')){const d=_pm.get(c.id);if(d)await _rt(c.id,d)}}_dz.onclick=()=>_fi.click();_dz.ondragover=e=>{e.preventDefault();_dz.style.background='#e6f2ff'};_dz.ondrop=e=>{e.preventDefault();_dz.style.background='#fff';_hf(e.dataTransfer.files)};_fi.onchange=e=>_hf(e.target.files);_pl.ondragover=e=>{e.preventDefault();const d=_0x.querySelector('.dragging');if(d){const a=_ga(_pl,e.clientX,e.clientY);a?_pl.insertBefore(d,a):_pl.appendChild(d)}};function _ga(c,x,y){const el=[...c.querySelectorAll('.page-card:not(.dragging)')];return el.reduce((cl,ch)=>{const b=ch.getBoundingClientRect(),cx=b.left+b.width/2,cy=b.top+b.height/2,dt=Math.hypot(x-cx,y-cy);return dt<cl.dt?{dt:dt,el:ch}:cl},{dt:Infinity}).el}async function _hf(fs){for(const f of fs){if(f.type!=='application/pdf')continue;const b=await f.arrayBuffer(),sid=Date.now()+'-'+Math.random();_sm.set(sid,{buffer:b,name:f.name.replace('.pdf','')});const p=await pdfjsLib.getDocument(b).promise;for(let i=1;i<=p.numPages;i++)await _cc(p,i,sid,f.name)}_up()}async function _cc(p,n,s,fn){const id='c-'+Math.random().toString(36).substr(2,9),cd=document.createElement('div');cd.className='page-card selected';cd.id=id;cd.draggable=!0;cd.innerHTML=`<div class="page-number-label">‡∏´‡∏ô‡πâ‡∏≤ ${n}</div><input type="checkbox" class="page-checkbox" checked onclick="this.parentNode.classList.toggle('selected',this.checked)"><div class="rotate-btn" onclick="_ro('${id}')">‚Üª</div><div class="delete-btn" onclick="_rm('${id}')">&times;</div><canvas id="can-${id}"></canvas><div class="page-info" style="font-size:10px">${fn}</div>`;cd.ondragstart=e=>{cd.classList.add('dragging');const g=cd.cloneNode(!0);g.style.opacity='0.5';_0x.body.appendChild(g);e.dataTransfer.setDragImage(g,e.offsetX,e.offsetY);setTimeout(()=>_0x.body.removeChild(g),0)};cd.ondragend=()=>cd.classList.remove('dragging');_pl.appendChild(cd);_pm.set(id,{sourceId:s,pageIndex:n-1,rotation:0});await _rt(id,_pm.get(id))}async function _rt(id,d){const s=_sm.get(d.sourceId),p=await(await pdfjsLib.getDocument(s.buffer.slice(0)).promise).getPage(d.pageIndex+1),vb=p.getViewport({scale:1}),is=d.rotation%180!==0,sc=(_bh/(is?vb.width:vb.height))*(window.devicePixelRatio||1),tr=(p.rotate+d.rotation)%360,vp=p.getViewport({scale:sc,rotation:tr}),cn=_q('can-'+id),ctx=cn.getContext('2d');cn.width=vp.width;cn.height=vp.height;cn.style.height=_bh+'px';await p.render({canvasContext:ctx,viewport:vp}).promise}window._ro=async(id)=>{const d=_pm.get(id);d.rotation=(d.rotation+90)%360;await _rt(id,d)};window._rm=id=>{_pm.delete(id);_q(id).remove();_up()};window._sa=s=>{_0x.querySelectorAll('.page-card').forEach(c=>{c.querySelector('input').checked=s;c.classList.toggle('selected',s)})};window._rs=()=>{if(_pm.size&&confirm("Reset?")){_pm.clear();_sm.clear();_pl.innerHTML='';_up()}};function _up(){_aa.style.display=_pm.size>0?'flex':'none'}window._pr=async(m)=>{const sd=[..._0x.querySelectorAll('.page-card')].filter(c=>c.querySelector('input').checked);if(!sd.length)return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô");const{PDFDocument:PD,degrees:dg}=PDFLib,_ca=new Map(),z=new JSZip(),mp=m==='merge'?await PD.create():null;for(const c of sd){const d=_pm.get(c.id);let sP=await(async()=>{if(!_ca.has(d.sourceId)){const b=_sm.get(d.sourceId).buffer,dc=await PD.load(b);_ca.set(d.sourceId,dc)}return _ca.get(d.sourceId)})();const[cp]=await(m==='merge'?mp:await PD.create()).copyPages(sP,[d.pageIndex]);cp.setRotation(dg(cp.getRotation().angle+d.rotation));if(m==='merge')mp.addPage(cp);else if(m==='zip'){const sd=await PD.create(),[p]=await sd.copyPages(sP,[d.pageIndex]);p.setRotation(dg(p.getRotation().angle+d.rotation));sd.addPage(p);z.file(`P${sd.getPageCount()}_${_sm.get(d.sourceId).name}.pdf`,await sd.save())}else{const p=await(await pdfjsLib.getDocument(_sm.get(d.sourceId).buffer.slice(0)).promise).getPage(d.pageIndex+1),vp=p.getViewport({scale:3,rotation:(p.rotate+d.rotation)%360}),cn=document.createElement('canvas');cn.width=vp.width;cn.height=vp.height;await p.render({canvasContext:cn.getContext('2d'),viewport:vp}).promise;const bl=await new Promise(r=>cn.toBlob(r,'image/jpeg',.95));if(sd.length===1)return _dl(bl,`P1.jpg`);z.file(`P${ex++}.jpg`,bl)}}m==='merge'?_dl(await mp.save(),"Merged.pdf"):_dl(await z.generateAsync({type:"blob"}),"Export.zip")};function _dl(d,n){const b=d instanceof Blob?d:new Blob([d]),l=document.createElement('a');l.href=URL.createObjectURL(b);l.download=n;l.click()};const _0x=document;})()
</script>
</body>
</html>
